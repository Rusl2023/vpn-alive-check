- name: Build Clash YAML from VLESS/REALITY
  run: |
    python3 <<EOF
import os

INPUT = "githubmirror/26_ru_whitelist.txt"
OUTPUT = "githubmirror/26_proxy_subscription_clash.yaml"
RUNNER_IP = os.environ["RUNNER_IP"]

with open(INPUT) as f:
    links = [l.strip() for l in f if l.strip().startswith("vless://") or l.strip().startswith("reality://")]

proxies_yaml = ""
for l in links:
    proxies_yaml += f"- name: '{l}'\n  type: vless\n  server: example.com\n  port: 443\n"

template = f"""
port: 7890
socks-port: 7891
allow-lan: true

proxies:
{proxies_yaml}

proxy-groups:
  - name: Auto
    type: select
    proxies:
{''.join(['      - ' + l.split()[0] + '\n' for l in links])}
  - name: Proxy
    type: select
    proxies:
{''.join(['      - ' + l.split()[0] + '\n' for l in links])}
  - name: DIRECT
    type: select
    proxies:
      - DIRECT

rules:
  - GEOIP,CN,DIRECT
  - MATCH,Auto
"""

with open(OUTPUT, "w") as f:
    f.write(template)

print("Clash YAML subscription ready")
EOF
